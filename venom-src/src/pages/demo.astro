---
import '../styles/tailwind.css';
const title = 'VENOM Demo - Interactive AI Crawler Preview';
const description = 'See how VENOM transforms content for AI crawlers while preserving the human experience.';
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#0b0f14" />
    <link rel="icon" href="/venom/favicon.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Grotesk:wght@600;700&family=Red+Hat+Display:wght@600;700;800&display=swap" rel="stylesheet">
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://semiautonomous.systems/venom/demo/" />
    <title>{title}</title>
  </head>
  <body class="min-h-screen text-slate-200">
    <header class="sticky top-0 z-20 backdrop-blur-md border-b border-slate-800/80">
      <div class="max-w-[1060px] mx-auto w-[90%] flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 py-3">
        <a href="/venom/" class="flex items-center gap-2 font-extrabold tracking-wide hover:opacity-80 transition">
          <span class="inline-flex"><svg viewBox="0 0 24 24" class="w-[22px] h-[22px] drop-shadow-[0_0_8px_rgba(183,33,21,0.85)]"><path d="M6 9c0-2.8 2.2-5 5-5 2.2 0 4 1.8 4 4 0 1.7-1.1 3-2.8 3H10c-1.7 0-3 1.3-3 3s1.3 3 3 3h6" fill="none" stroke="#b72115" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 17c0 0 1.5 0 2 0.5" fill="none" stroke="#b72115" stroke-width="1.5" stroke-linecap="round"/><circle cx="14.5" cy="7.5" r="0.9" fill="#b72115"/></svg></span>
          <span class="text-sm uppercase" style="font-family: 'Red Hat Display', Inter, ui-sans-serif, system-ui, sans-serif; font-weight: 700; color: #b72115;">VENOM</span>
        </a>
        <nav class="flex flex-wrap justify-center gap-3 sm:gap-5 text-slate-400 text-sm">
          <a href="/venom/" class="hover:text-slate-200">Home</a>
          <a href="/venom/#about" class="hover:text-slate-200">About</a>
          <a href="/venom/#how" class="hover:text-slate-200">How it works</a>
          <a href="/venom/#features" class="hover:text-slate-200">Features</a>
          <span class="text-slate-200 font-semibold">Demo</span>
        </nav>
      </div>
    </header>

    <main class="py-8 sm:py-12">
      <section class="max-w-[1060px] mx-auto w-[90%]">
        <!-- Title -->
        <div class="text-center mb-8">
          <h1 class="text-2xl sm:text-3xl font-bold mb-2" style="font-family: 'Space Grotesk', sans-serif;">
            Interactive Demo
          </h1>
          <p class="text-slate-400 text-sm sm:text-base">
            Enter any URL to compare the original vs. AI crawler view
          </p>
        </div>

        <!-- Controls -->
        <div class="glass p-4 sm:p-6 mb-6">
          <div class="flex flex-col gap-4">
            <!-- URL Input -->
            <div>
              <label for="url-input" class="block text-sm text-slate-400 mb-1">Website URL</label>
              <input 
                type="url" 
                id="url-input" 
                placeholder="https://example.com"
                value="https://example.com"
                class="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-slate-500 text-sm sm:text-base"
              />
            </div>
            
            <!-- Options Row -->
            <div class="flex flex-col sm:flex-row gap-4">
              <div class="flex-1">
                <label for="bot-select" class="block text-sm text-slate-400 mb-1">Bot Type</label>
                <select id="bot-select" class="w-full px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-200 focus:outline-none focus:border-slate-500">
                  <option value="gptbot">GPTBot (OpenAI)</option>
                  <option value="claude">Claude (Anthropic)</option>
                  <option value="google">Google AI</option>
                  <option value="bingbot">Bing AI</option>
                  <option value="meta">Meta AI</option>
                </select>
              </div>
              <div class="flex-1">
                <label for="device-select" class="block text-sm text-slate-400 mb-1">Device</label>
                <select id="device-select" class="w-full px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-slate-200 focus:outline-none focus:border-slate-500">
                  <option value="desktop">Desktop (1280×720)</option>
                  <option value="mobile">Mobile (390×844)</option>
                </select>
              </div>
              <div class="flex items-end">
                <label class="flex items-center gap-2 cursor-pointer py-2">
                  <input type="checkbox" id="inline-mode" checked class="w-4 h-4 rounded bg-slate-800 border-slate-600" />
                  <span class="text-sm text-slate-400">Inline Mode</span>
                </label>
              </div>
            </div>

            <!-- Load Button -->
            <button 
              id="load-btn"
              class="btn btn-primary w-full sm:w-auto px-8 py-3 text-center"
            >
              Load Preview
            </button>
          </div>
        </div>

        <!-- Screenshot Panels -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-8">
          <!-- Original -->
          <div class="glass p-4">
            <h3 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-green-500"></span>
              Original (Human View)
            </h3>
            <div id="original-panel" class="aspect-video bg-slate-800/50 rounded-lg flex items-center justify-center text-slate-500 text-sm overflow-hidden">
              Click "Load Preview" to generate
            </div>
            <div id="original-stats" class="text-xs text-slate-500 mt-2"></div>
          </div>
          
          <!-- Poisoned -->
          <div class="glass p-4">
            <h3 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-red-500"></span>
              Venom Preview (AI Crawler View)
            </h3>
            <div id="poisoned-panel" class="aspect-video bg-slate-800/50 rounded-lg flex items-center justify-center text-slate-500 text-sm overflow-hidden">
              Click "Load Preview" to generate
            </div>
            <div id="poisoned-stats" class="text-xs text-slate-500 mt-2"></div>
          </div>
        </div>

        <!-- Quick Examples -->
        <div class="glass p-4 sm:p-6">
          <h4 class="text-sm font-semibold text-slate-300 mb-4">Quick Examples</h4>
          <div class="flex flex-wrap gap-2">
            <button data-url="https://www.bbc.com" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">BBC News</button>
            <button data-url="https://en.wikipedia.org/wiki/Artificial_intelligence" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">Wikipedia</button>
            <button data-url="https://arxiv.org" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">arXiv</button>
            <button data-url="https://www.etsy.com" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">Etsy</button>
            <button data-url="https://developer.mozilla.org" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">MDN</button>
            <button data-url="https://www.whitehouse.gov" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">White House</button>
            <button data-url="https://stackoverflow.com" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">Stack Overflow</button>
            <button data-url="https://www.nature.com" class="example-btn pill hover:bg-slate-800 hover:text-slate-200 transition cursor-pointer">Nature</button>
          </div>
        </div>
      </section>
    </main>

    <footer class="border-t border-slate-800/80 py-6 text-center text-slate-500 text-sm">
      <p class="mb-2">
        <a href="/venom/" class="hover:text-slate-300 transition">← Back to VENOM</a>
      </p>
      <p>© {new Date().getFullYear()} Semiautonomous Systems, Inc.</p>
    </footer>

    <script>
      const API_BASE = 'https://ecdsa.pub/venom-preview/api';
      
      const urlInput = document.getElementById('url-input');
      const botSelect = document.getElementById('bot-select');
      const deviceSelect = document.getElementById('device-select');
      const inlineMode = document.getElementById('inline-mode');
      const loadBtn = document.getElementById('load-btn');
      const originalPanel = document.getElementById('original-panel');
      const poisonedPanel = document.getElementById('poisoned-panel');
      const originalStats = document.getElementById('original-stats');
      const poisonedStats = document.getElementById('poisoned-stats');

      let abortController = null;

      function showLoading(panel) {
        panel.innerHTML = `
          <div class="flex flex-col items-center gap-2 text-slate-400">
            <div class="animate-pulse text-2xl">●●●</div>
            <span class="text-xs">Generating screenshot...</span>
          </div>
        `;
      }

      function showError(panel, message) {
        panel.innerHTML = `
          <div class="text-red-400 text-center p-4">
            <div class="text-xl mb-2">⚠</div>
            <span class="text-xs">${message}</span>
          </div>
        `;
      }

      function showImage(panel, url) {
        panel.innerHTML = `<img src="${url}" alt="Screenshot" class="w-full h-full object-contain" loading="eager" />`;
      }

      async function loadPreview() {
        const url = urlInput.value.trim();
        if (!url) {
          alert('Please enter a URL');
          return;
        }

        // Abort any ongoing request
        if (abortController) {
          abortController.abort();
        }
        abortController = new AbortController();

        const bot = botSelect.value;
        const mode = deviceSelect.value;
        const inline = inlineMode.checked;

        // Update UI
        loadBtn.disabled = true;
        loadBtn.textContent = 'Loading...';
        showLoading(originalPanel);
        showLoading(poisonedPanel);
        originalStats.textContent = '';
        poisonedStats.textContent = '';

        try {
          // Build API URLs
          const originalUrl = `${API_BASE}/snap?url=${encodeURIComponent(url)}&mode=${mode}`;
          const poisonedUrl = `${API_BASE}/snap?url=${encodeURIComponent(url)}&bot=${bot}&mode=${mode}${inline ? '&inline=true' : ''}`;

          // Fetch both screenshots in parallel
          const [originalResp, poisonedResp] = await Promise.all([
            fetch(originalUrl, { signal: abortController.signal }),
            fetch(poisonedUrl, { signal: abortController.signal })
          ]);

          if (!originalResp.ok || !poisonedResp.ok) {
            throw new Error('Failed to generate screenshots');
          }

          // Get image blobs and create object URLs
          const [originalBlob, poisonedBlob] = await Promise.all([
            originalResp.blob(),
            poisonedResp.blob()
          ]);

          showImage(originalPanel, URL.createObjectURL(originalBlob));
          showImage(poisonedPanel, URL.createObjectURL(poisonedBlob));

          // Update stats from headers
          const originalSize = poisonedResp.headers.get('X-Venom-Original-Size');
          const poisonedSize = poisonedResp.headers.get('Content-Length');
          
          originalStats.textContent = `Mode: ${mode}`;
          poisonedStats.textContent = `Bot: ${bot}${inline ? ' (inline)' : ''}`;

        } catch (err) {
          if (err.name === 'AbortError') return;
          console.error('Error:', err);
          showError(originalPanel, 'Failed to load');
          showError(poisonedPanel, err.message || 'Failed to load');
        } finally {
          loadBtn.disabled = false;
          loadBtn.textContent = 'Load Preview';
        }
      }

      // Event listeners
      loadBtn.addEventListener('click', loadPreview);
      
      urlInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') loadPreview();
      });

      // Example buttons
      document.querySelectorAll('.example-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          urlInput.value = btn.dataset.url;
          loadPreview();
        });
      });
    </script>
  </body>
</html>
